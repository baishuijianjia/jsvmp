<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSVMP Web ç¤ºä¾‹</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
        .output { background: #f4f4f4; padding: 15px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸš€ JSVMP - JavaScriptè™šæ‹Ÿæœº Webç¤ºä¾‹</h1>
    
    <textarea id="codeEditor" placeholder="è¾“å…¥JavaScriptä»£ç ...">
// é—­åŒ…å’Œä½œç”¨åŸŸæ¼”ç¤º - å¤šä¸ªè®¡æ•°å™¨ç›¸äº’ç‹¬ç«‹
function createCounter(initialValue) {
    var count = initialValue || 0;
    
    return function() {
        count++;
        return count;
    };
}

var counter1 = createCounter(10);
var counter2 = createCounter(100);

var results = [];
results.push(counter1()); // 11
results.push(counter1()); // 12
results.push(counter2()); // 101
results.push(counter1()); // 13
results.push(counter2()); // 102

results
    </textarea>
    
    <div>
        <button onclick="runCode()">â–¶ï¸ è¿è¡Œä»£ç </button>
        <button onclick="clearOutput()">ğŸ—‘ï¸ æ¸…ç©º</button>
        <button onclick="loadExample('closure')">ğŸ”— é—­åŒ…ç¤ºä¾‹</button>
        <button onclick="loadExample('fibonacci')">ğŸ“ æ–æ³¢é‚£å¥‘</button>
        <button onclick="loadExample('oop')">ğŸ›ï¸ é¢å‘å¯¹è±¡</button>
        <button onclick="loadExample('functional')">âš¡ å‡½æ•°å¼ç¼–ç¨‹</button>
        <button onclick="loadExample('external')">ğŸ“¥ å¤–éƒ¨å˜é‡</button>
    </div>
    
    <div class="output" id="output">ç‚¹å‡»è¿è¡Œä»£ç æŸ¥çœ‹ç»“æœ...</div>

    <!-- å¼•å…¥JSVMPåº“ -->
    <script src="../dist/jsvmp.js"></script>
    
    <script>
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå†åˆå§‹åŒ–
        let vm;
        
        // ç¡®ä¿JSVMPåº“å·²åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            try {
                vm = new JSVMP.JSVMP();
                console.log('JSVMPè™šæ‹Ÿæœºåˆå§‹åŒ–æˆåŠŸ');
            } catch (error) {
                console.error('JSVMPåˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('output').innerHTML = 
                    `<strong>âŒ åˆå§‹åŒ–é”™è¯¯:</strong><br>${error.message}`;
            }
        });
        
        function runCode() {
            const code = document.getElementById('codeEditor').value;
            const outputElement = document.getElementById('output');
            
            // æ£€æŸ¥vmæ˜¯å¦å·²åˆå§‹åŒ–
            if (!vm) {
                outputElement.innerHTML = '<strong>âš ï¸ è­¦å‘Š:</strong><br>è™šæ‹Ÿæœºå°šæœªåˆå§‹åŒ–ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»...';
                outputElement.style.background = '#fff3cd';
                return;
            }
            
            if (!code.trim()) {
                outputElement.innerHTML = '<strong>âš ï¸ è­¦å‘Š:</strong><br>è¯·è¾“å…¥JavaScriptä»£ç ';
                outputElement.style.background = '#fff3cd';
                return;
            }
            
            try {
                let result;
                let context = {};
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å¤–éƒ¨å˜é‡ç¤ºä¾‹
                if (code.includes('userName') && code.includes('externalFunction')) {
                    // ä¸ºå¤–éƒ¨å˜é‡ç¤ºä¾‹å‡†å¤‡ context
                    context = {
                        userName: 'å°æ˜',
                        currentDate: new Date().toLocaleDateString('zh-CN'),
                        userScore: 85,
                        externalFunction: function(num) {
                            return num * 2;
                        },
                        config: {
                            theme: 'light',
                            debug: true
                        }
                    };
                    
                    outputElement.innerHTML += '<br><strong>ğŸ“¥ ä¼ å…¥çš„å¤–éƒ¨å˜é‡:</strong><br><pre>' + 
                        JSON.stringify({
                            userName: context.userName,
                            currentDate: context.currentDate,
                            userScore: context.userScore,
                            'externalFunction': '[Function: åŒå€è®¡ç®—]',
                            config: context.config
                        }, null, 2) + '</pre><br>';
                }
                
                result = vm.run(code, context);
                outputElement.innerHTML += `<strong>âœ… æ‰§è¡Œç»“æœ:</strong><br><pre>${JSON.stringify(result, null, 2)}</pre>`;
                outputElement.style.background = '#e8f5e8';
            } catch (error) {
                outputElement.innerHTML = `<strong>âŒ é”™è¯¯:</strong><br>${error.message}`;
                outputElement.style.background = '#f5e8e8';
                console.error('æ‰§è¡Œé”™è¯¯:', error);
            }
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = 'è¾“å‡ºå·²æ¸…ç©º...';
            document.getElementById('output').style.background = '#f4f4f4';
        }
        
        function loadExample(type) {
            const codeEditor = document.getElementById('codeEditor');
            
            const examples = {
                closure: `// é—­åŒ…å’Œä½œç”¨åŸŸæ¼”ç¤º - å¤šä¸ªè®¡æ•°å™¨ç›¸äº’ç‹¬ç«‹
function createCounter(initialValue) {
    var count = initialValue || 0;
    
    return function() {
        count++;
        return count;
    };
}

var counter1 = createCounter(10);
var counter2 = createCounter(100);

var results = [];
results.push(counter1()); // 11
results.push(counter1()); // 12
results.push(counter2()); // 101
results.push(counter1()); // 13
results.push(counter2()); // 102

results`,
                fibonacci: `// æ–æ³¢é‚£å¥‘æ•°åˆ—æ¼”ç¤º
function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

var result = [];
for (var i = 0; i < 10; i++) {
    result.push(fibonacci(i));
}
result`,
                oop: `// é¢å‘å¯¹è±¡ç¼–ç¨‹æ¼”ç¤º
function Person(name, age) {
    this.name = name;
    this.age = age;
    
    this.greet = function() {
        return "ä½ å¥½ï¼Œæˆ‘æ˜¯" + this.name + "ï¼Œä»Šå¹´" + this.age + "å²";
    };
    
    this.celebrateBirthday = function() {
        this.age++;
        return this.name + "ç”Ÿæ—¥å¿«ä¹ï¼ç°åœ¨" + this.age + "å²äº†";
    };
}

var person = new Person("å°æ˜", 25);
var greeting = person.greet();
var birthday = person.celebrateBirthday();

[greeting, birthday, person.age]`,
                functional: `// å‡½æ•°å¼ç¼–ç¨‹æ¼”ç¤º
function map(array, fn) {
    var result = [];
    for (var i = 0; i < array.length; i++) {
        result.push(fn(array[i], i));
    }
    return result;
}

function filter(array, fn) {
    var result = [];
    for (var i = 0; i < array.length; i++) {
        if (fn(array[i], i)) {
            result.push(array[i]);
        }
    }
    return result;
}

var numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// å¹³æ–¹
var squares = map(numbers, function(x) { return x * x; });

// è¿‡æ»¤å¶æ•°
var evens = filter(numbers, function(x) { return x % 2 === 0; });

({
    original: numbers,
    squares: squares,
    evens: evens
})`,
                external: `// å¤–éƒ¨å˜é‡ä¼ å…¥æ¼”ç¤º
// è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†å¤–éƒ¨JavaScriptå˜é‡ä¼ å…¥è™šæ‹Ÿæœº

// åœ¨è™šæ‹Ÿæœºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å¤–éƒ¨ä¼ å…¥çš„å˜é‡
var message = "ä½ å¥½ï¼Œ" + userName + "ï¼";
message += "\\nä»Šå¤©æ˜¯ï¼š" + currentDate;
message += "\\nä½ çš„åˆ†æ•°ï¼š" + userScore + " åˆ†";

// ä½¿ç”¨å¤–éƒ¨å‡½æ•°
var doubled = externalFunction(userScore);

// ä½¿ç”¨å¤–éƒ¨å¯¹è±¡
var configInfo = "ä¸»é¢˜ï¼š" + config.theme + "ï¼Œè°ƒè¯•æ¨¡å¼ï¼š" + config.debug;

// åˆ›å»ºç»“æœå¯¹è±¡
({
    personalMessage: message,
    doubledScore: doubled,
    configInfo: configInfo,
    isValid: userScore >= 60
})`
            };
            
            if (examples[type]) {
                if (type === 'external') {
                    // å¯¹äºå¤–éƒ¨å˜é‡ç¤ºä¾‹ï¼Œéœ€è¦æä¾›ç‰¹æ®Šå¤„ç†
                    codeEditor.value = examples[type];
                    clearOutput();
                    // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    const outputElement = document.getElementById('output');
                    outputElement.innerHTML = '<strong>ğŸ’¡ æç¤º:</strong><br>è¿™ä¸ªç¤ºä¾‹éœ€è¦å¤–éƒ¨å˜é‡ã€‚ç‚¹å‡»"è¿è¡Œä»£ç "æ—¶ä¼šè‡ªåŠ¨ä¼ å…¥ç¤ºä¾‹å˜é‡ã€‚';
                    outputElement.style.background = '#e6f3ff';
                } else {
                    codeEditor.value = examples[type];
                    clearOutput();
                }
            }
        }
    </script>
</body>
</html> 